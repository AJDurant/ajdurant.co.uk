<!doctype html>
<html lang="">
    <head>
        <meta charset="utf-8">
        <title>A short time spent with multiviews - AJDurant</title>

        <meta name="description" content="Andy Durant - Computer Scientist, Christian, Software Dev, Web Dev, Student">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Disable tap highlight on IE -->
        <meta name="msapplication-tap-highlight" content="no">

        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="application-name" content="AJDurant">
        <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16">

        <!-- Add to homescreen for Safari on iOS -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="AJDurant">
        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/images/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/images/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/images/apple-touch-icon-152x152.png">

        <!-- Tile icon for Win8 (144x144 + tile color) -->
        <meta name="msapplication-TileImage" content="/assets/images/mstile-144x144.png">
        <meta name="msapplication-TileColor" content="#2F3BA2">

        <!-- Color the status bar on mobile devices -->
        <meta name="theme-color" content="#2F3BA2">

        <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
        <!--
        <link rel="canonical" href="http://www.example.com/">
        -->

        <!-- Page styles -->

        <link rel="stylesheet" href="assets/styles/vendor.css">

        <link rel="stylesheet" href="assets/styles/site.css">
    </head>
    <body>

    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
              <!-- Title -->
              <span class="mdl-layout-title">A short time spent with multiviews - <strong>Andy Durant</strong></span>
              <!-- Add spacer, to align navigation to the right -->
              <div class="mdl-layout-spacer"></div>
              <!-- Navigation. We hide it in small screens. -->
              <nav class="mdl-navigation mdl-layout--large-screen-only">
                <a class="mdl-navigation__link" href="/">Hello</a>
                <a class="mdl-navigation__link" href="/blog.html">Blog</a>
              </nav>
            </div>
        </header>
        <div class="mdl-layout__drawer">
          <span class="mdl-layout-title">Andy Durant</span>
          <nav class="mdl-navigation">
            <a class="mdl-navigation__link" href="/">Hello</a>
            <a class="mdl-navigation__link" href="/blog.html">Blog</a>
          </nav>
        </div>

        <main class="mdl-layout__content">
            <div class="mdl-grid">
                <!-- Your content goes here -->
                
    <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
    <div class="page-content mdl-color--white mdl-shadow--4dp mdl-cell mdl-cell--8-col">

        <h2>A short time spent with multiviews</h2>

        <div class="mdl-color-text--grey-700 meta">
            <span>2012-07-19</span>
            <div class="section-spacer"></div>
            
                <a class="tag" href="/tag/apache.html">apache</a>
            
                <a class="tag" href="/tag/multiviews.html">multiviews</a>
            
                <a class="tag" href="/tag/mod_rewrite.html">mod_rewrite</a>
            
                <a class="tag" href="/tag/website.html">website</a>
            
                <a class="tag" href="/tag/server.html">server</a>
            
        </div>
        <p>
            <p>I&#39;ve recently been building a new website, well newish. It&#39;s a re-design and replacement for a website written a couple of years back and made in the CMS Drupal. I also recently read (albeit rather old) an article on <a href="http://www.w3.org/Provider/Style/URI" title="Cool URIs don&#39;t change">URIs not changing</a>. Now this prompted various thoughts into my head, some of which I had had whist designing this other website. Such as why do I have to have .html on all my URIs? The old site most of the content was coming from didn&#39;t (I know this is down to mod_rewrite for fancy SEO urls by Drupal, but all the same).</p>
<p>So I started to try and find out what Sir Tim was on about here, something really simple you can add that makes it &#39;just work&#39; that doesn&#39;t sound like any web development I&#39;ve done before... There seemed to be lots of posts from people who had also read the article and were looking for the answer, but no-one else seemed to know it, nearly everyone pointed to use some variant of mod_rewrite to various degrees of complexity. But then I found the answer, it really was quite simple, enable MultiViews in your apache config for that directory, and it would &#39;just work&#39; you could even have it auto detect language setting from the browser.</p>
<pre class="brush: plain; gutter: false">Options MultiViews</pre>

<p>A quick update and build later and both the site I was working on and my main website were extensionless and wonderful. However this was not to be the end of the story.
<!--more-->
The main point of Sir Tim&#39;s article is that uris should not go away, even if the content changes a bit, or the website is redesigned, or passes to someone else (all three of which were happening on this website). So earlier this night, having almost completely finished the site, I set about creating the redirects for the pages I&#39;d moved to renamed.</p>
<p>However, after wrestling with apache rewrite and various server configs with it still not working properly, I remembered what I had had to do to get multiviews working in the first place... Helpfully the <a href="h5bp.com" title="HTML5 BoilerPlate">h5bp</a> developers had configured multiviews to be disabled, which i had commented out. The reason behind this is it causes problems with redirects... So having enabled it, then tried to add a number of redirects they just wouldn&#39;t work. Back to the drawing board (why would you write code on a drawing board?)</p>
<p>A bit more googleing later and I came up with a solution, the first of which was simply to re-create the multiviews effect by rewriting &#39;file&#39; to &#39;file.html&#39; nicely behind the scenes. However this did not solve one of the issues I had with MultiViews: someone can still access the .html file with extension (particularly if your website has already been crawled with it), thereby serving duplicate content a rather huge no-no. Obviously my previous attempts to redirect this failed due to multiviews blocking the redirect.</p>
<pre class="brush: plain"># If extensionless page URL with ".php" added resolves to an existing file
RewriteCond %{DOCUMENT_ROOT}/$1.php -f
# rewrite extensionless page URL to .php file
RewriteRule ^(([^/]+/)*[^./]+)$ /$1.php [L]</pre>

<p><a href="http://www.webmasterworld.com/apache/3800500.htm">http://www.webmasterworld.com/apache/3800500.htm</a></p>
<p>Then I found a second solution, that had everything I wanted. It would give you the file from just &#39;file&#39; it would redirect you to &#39;file&#39; from &#39;file.html&#39; and it would even remove index(.html)? from the URI to give you the root dir. Lovely.</p>
<pre class="brush: plain"><IfModule mod_rewrite.c> DirectorySlash Off
RewriteEngine On

RewriteCond %{THE_REQUEST} \ /(.+/)?index(\.html)?(\?.*)?\ [NC]
RewriteRule ^(.+/)?index(\.html)?$ /%1 [R=301,L]

RewriteCond %{SCRIPT_FILENAME}/ -d
RewriteCond %{SCRIPT_FILENAME}.html !-f
RewriteRule [^/]$ %{REQUEST_URI}/ [R=301,L]

RewriteCond %{ENV:REDIRECT_STATUS} ^$
RewriteRule ^(.+)\.html$ /$1 [R=301,L]

RewriteCond %{SCRIPT_FILENAME}.html -f
RewriteRule [^/]$ %{REQUEST_URI}.html [QSA,L]
</IfModule></pre>

<p><a href="http://forum.modrewrite.com/viewtopic.php?t=37515">http://forum.modrewrite.com/viewtopic.php?t=37515</a></p>
<p>So now multiviews is back off from the site and all this lovely mod_redirect goodness is in. My main site however shall keep multiviews for a little while, whilst I try to solve the duplicate content issue and update what Google has crawled.</p>

        </p>
        <div class="clearfix"></div>

        <aside>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'ajdurant'; // required: replace example with your forum shortname
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </aside>
    </div>

            </div>

            <div class="mdl-layout-spacer"></div>

            <footer class="mdl-mini-footer">
                <div class="mdl-mini-footer__left-section">
                    <div class="mdl-logo">Andy Durant</div>
                    <ul class="mdl-mini-footer__link-list">
                        <li><a href="#"></a></li>
                    </ul>
                </div>
                <div class="mdl-mini-footer__right-section">
                    <button class="mdl-mini-footer__social-btn social-btn">
                        <a href="https://github.com/AJDurant">
                            <i class="fa fa-github fa-2x"></i>
                            <span class="visuallyhidden">Github</span>
                        </a>
                    </button>
                    <button class="mdl-mini-footer__social-btn social-btn">
                        <a href="https://uk.linkedin.com/in/andydurant">
                            <i class="fa fa-linkedin fa-2x"></i>
                            <span class="visuallyhidden">Linkedin</span>
                        </a>
                    </button>
                    <button class="mdl-mini-footer__social-btn social-btn">
                        <a href="https://twitter.com/andydurant">
                            <i class="fa fa-twitter fa-2x"></i>
                            <span class="visuallyhidden">Twitter</span>
                        </a>
                    </button>
                </div>
            </footer>
        </main>

    </div>
        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-27946742-1', 'auto');
          ga('send', 'pageview');
        </script>

        <script src="assets/scripts/vendor.js"></script>

        
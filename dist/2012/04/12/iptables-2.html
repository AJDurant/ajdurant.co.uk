<!doctype html>
<html lang="">
    <head>
        <meta charset="utf-8">
        <title>iptables - Configuration (part 2) - AJDurant</title>

        <meta name="description" content="Andy Durant - Computer Scientist, Christian, Software Dev, Web Dev, Student">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Disable tap highlight on IE -->
        <meta name="msapplication-tap-highlight" content="no">

        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="application-name" content="AJDurant">
        <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16">

        <!-- Add to homescreen for Safari on iOS -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="AJDurant">
        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/images/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/images/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/images/apple-touch-icon-152x152.png">

        <!-- Tile icon for Win8 (144x144 + tile color) -->
        <meta name="msapplication-TileImage" content="/assets/images/mstile-144x144.png">
        <meta name="msapplication-TileColor" content="#2F3BA2">

        <!-- Color the status bar on mobile devices -->
        <meta name="theme-color" content="#2F3BA2">

        <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
        <!--
        <link rel="canonical" href="http://www.example.com/">
        -->

        <!-- Page styles -->

        <link rel="stylesheet" href="assets/styles/vendor.css">

        <link rel="stylesheet" href="assets/styles/site.css">
    </head>
    <body>

    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
              <!-- Title -->
              <span class="mdl-layout-title">iptables - Configuration (part 2) - <strong>Andy Durant</strong></span>
              <!-- Add spacer, to align navigation to the right -->
              <div class="mdl-layout-spacer"></div>
              <!-- Navigation. We hide it in small screens. -->
              <nav class="mdl-navigation mdl-layout--large-screen-only">
                <a class="mdl-navigation__link" href="/">Hello</a>
                <a class="mdl-navigation__link" href="/blog.html">Blog</a>
              </nav>
            </div>
        </header>
        <div class="mdl-layout__drawer">
          <span class="mdl-layout-title">Andy Durant</span>
          <nav class="mdl-navigation">
            <a class="mdl-navigation__link" href="/">Hello</a>
            <a class="mdl-navigation__link" href="/blog.html">Blog</a>
          </nav>
        </div>

        <main class="mdl-layout__content">
            <div class="mdl-grid">
                <!-- Your content goes here -->
                
    <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
    <div class="page-content mdl-color--white mdl-shadow--4dp mdl-cell mdl-cell--8-col">

        <h2>iptables - Configuration (part 2)</h2>

        <div class="mdl-color-text--grey-700 meta">
            <span>2012-04-12</span>
            <div class="section-spacer"></div>
            
                <a class="tag" href="/tag/iptables.html">iptables</a>
            
                <a class="tag" href="/tag/server.html">server</a>
            
        </div>
        <p>
            <p>So now down to the nitty gritty of actually getting rules written for iptables.</p>
<p>To add a rule the commands can range from very simple, to long and complex.<!--more--> The simplest type I use is something like this:</p>
<pre class="brush: bash; gutter: false">iptables -A INPUT -d 109.200.20.250 -p tcp --dport 80 -j ACCEPT

</pre>

<p>A quick break down of this:</p>
<ul>
<li>iptables -- the program called to run the command</li>
<li>-A -- Append the rule, here to the chain INPUT</li>
<li>-d -- Destination address the packet is trying to get to</li>
<li>-p -- Protocol, here tcp but could be udp.</li>
<li>-dport -- Destination port, where is being accessed, here is port 80 for http</li>
<li>-j -- Jump, this says what to do if everything in the rule is matched, so if everything is okay, the packet is accepted.</li>
</ul>
<p>The first tip I learnt was to write these commands into a bash script, as having to re-type them (even with bash_history) would be a laborious task when clearing and reloading rules during the configuration phase.</p>
<p>So I write commands like this for all the ports I want open, and then finish the bash off with:</p>
<pre class="brush: bash">iptables -A INPUT -d 109.200.20.250 -j DROP
iptables -A INPUT -j DROP
iptables -A FORWARD -j DROP
</pre>

<p>This tells iptables to drop, firstly anything sent to me, then anything trying to pass through my ip. You may wonder why I&#39;m dropping everything, surely that invalidates all the previous rules? Well no, it doesn&#39;t as when a rule is matched it immediately jumps to its destination ignoring all else, which is why these must come at the end of the rules.</p>
<p>You may also be wondering, why DROP? I&#39;ve heard about REJECT. The difference between them is subtle, as both drop the packets. However, reject sends back a response to say &#39;no access&#39;. So to minimise traffic, it seems best from my point of view to drop anything else.</p>
<p>There are advantages and disadvantages to doing it both ways, but so called stealth isn&#39;t really a reason for or against either. A port scan will return closed on reject, and open on accept, but something like filtered on dropped packets, so there isn&#39;t much stealthy advantage.</p>
<p>Now, there is a lot more that can be done, the rules I&#39;ve mentioned so far are truly the most basic, but more on that in the next part. I also mentioned Chains, those will come up again sometime in the future. I also still haven&#39;t covered how to actually make this into a working firewall.</p>
<p>More advanced configuration in part 3.</p>

        </p>
        <div class="clearfix"></div>

        <aside>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'ajdurant'; // required: replace example with your forum shortname
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </aside>
    </div>

            </div>

            <div class="mdl-layout-spacer"></div>

            <footer class="mdl-mini-footer">
                <div class="mdl-mini-footer__left-section">
                    <div class="mdl-logo">Andy Durant</div>
                    <ul class="mdl-mini-footer__link-list">
                        <li><a href="#"></a></li>
                    </ul>
                </div>
                <div class="mdl-mini-footer__right-section">
                    <button class="mdl-mini-footer__social-btn social-btn">
                        <a href="https://github.com/AJDurant">
                            <i class="fa fa-github fa-2x"></i>
                            <span class="visuallyhidden">Github</span>
                        </a>
                    </button>
                    <button class="mdl-mini-footer__social-btn social-btn">
                        <a href="https://uk.linkedin.com/in/andydurant">
                            <i class="fa fa-linkedin fa-2x"></i>
                            <span class="visuallyhidden">Linkedin</span>
                        </a>
                    </button>
                    <button class="mdl-mini-footer__social-btn social-btn">
                        <a href="https://twitter.com/andydurant">
                            <i class="fa fa-twitter fa-2x"></i>
                            <span class="visuallyhidden">Twitter</span>
                        </a>
                    </button>
                </div>
            </footer>
        </main>

    </div>
        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-27946742-1', 'auto');
          ga('send', 'pageview');
        </script>

        <script src="assets/scripts/vendor.js"></script>

        